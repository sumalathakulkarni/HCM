@{
    ViewData["Title"] = "Skills";
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
        <li class="breadcrumb-item active">Skills</li>
    </ol>
</nav>
<div class="container-fluid">
    <div class="alert alert-success" role="alert">
        <button type="button" id="btnAddNewSkill" class="btn btn-primary"><i class="bi bi-plus-square-fill"></i>&nbsp;&nbsp;New Skill</button>
    </div>
</div>

<div class="container-fluid">
    <div>
        <table id="tblSkills" class="table table-striped table-hover" style="width:100%">
            <thead>
                <tr>
                    <th>Skill ID</th>
                    <th>Skill Name</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
        </table>
    </div>
</div>

@section scripts
{
    <script type="text/javascript">

        $(document).ready(function () {
            $(function () {
                // var bootstrapButton = $.fn.button.noConflict();
                // $.fn.bootstrapBtn = bootstrapButton;
                LoadSkillsData();
            });
        });

        function LoadSkillsData() {

            $.ajax({
                "type": "GET",
                "url": "/Skill/GetAllSkills",
                contentType: "application/json; charset=utf-8",
                datatype: "json",

                success: function (data) {

                    tblSkills = $("#tblSkills").DataTable({
                        "data": data,
                        scrollY: '400px',
                        scrollCollapse: true,
                        destroy: true,

                        "columnDefs": [
                            {
                                "targets": [0],
                                "data": "skillID",
                                "searchable": false,
                                "orderable": false,
                            },
                            {
                                "targets": [1],
                                "data": "skillName",
                                "className": "dt-left"
                            },
                            {
                                "targets": [2],
                                "data": null,
                                "orderable": false,
                                "searchable": false,
                                "defaultContent": '<a href="#" class="btn btn-sm btn-row" role="button" title="Edit" name="Edit" id="Edit"><i class="bi bi-pencil"></i></a>'
                            },
                            {
                                "targets": [3],
                                "data": null,
                                "orderable": false,
                                "searchable": false,
                                "defaultContent": '<a href="#" class="btn btn-sm btn-row" role="button" title="Delete" name="Delete" id="Delete"><i class="bi bi-trash"></i></a>'
                            }
                        ]
                    });

                    $('#btnAddNewSkill').click(function (e) {
                        
                        e.preventDefault();
                        $.ajax({
                            type: "GET",
                            url: "/Skill/AddSkill",
                            success: function (response) {
                                $('#dialog-view').html(response);
                                $("#dialog-view").dialog({
                                    title: "Add Skill",
                                    resizable: false,
                                    height: "auto",
                                    width: 400,
                                    modal: true
                                });

                                $('#btnSaveNewSkill').click(function (event) {

                                    event.preventDefault();
                                    var SkillID = 0;
                                    var SkillName = $("#SkillName").val();
                                    $.ajax({
                                        type: "POST",
                                        url: "/Skill/SaveSkill",
                                        data: { SkillID: SkillID, SkillName: SkillName },

                                        success: function (data) {
                                            $("#dialog-view").dialog("close");
                                            LoadSkillsData();
                                            toastr.success('Skill ' + SkillName + ' is Created', 'Confirmation');
                                        },
                                        error: function (ex) {
                                            alert('in error');
                                        }
                                    })
                                })
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            },
                            error: function (response) {
                                alert(response.responseText);
                            }
                        });
                    });

                    $("#tblSkills").on("click", ".btn-row", function (e) {

                        var action = $(this).attr("Name");

                        var tr = $(this).closest('tr');
                        var row = tblSkills.rows(tr);
                        var skill = row.data()[0];
                        var skillID = row.data()[0].skillID;
                        var skillName = row.data()[0].skillName;

                        if (action == "Edit") {
                            e.preventDefault();
                            $.ajax({
                                type: "POST",
                                url: "/Skill/EditSkill",
                                data: skill,
                                success: function (response) {
                                    $('#dialog-view').html(response);
                                    $("#dialog-view").dialog({
                                        title: "Edit Skill",
                                        resizable: false,
                                        height: "auto",
                                        width: 400,
                                        modal: true
                                    });

                                    $('#btnSaveExistingSkill').click(function (event) {
                                        debugger;
                                        event.preventDefault();
                                        var SkillID = $("#SkillID").val();
                                        var SkillName = $("#SkillName").val();
                                        $.ajax({
                                            type: "POST",
                                            url: "/Skill/SaveSkill",
                                            data: { SkillID: SkillID, SkillName: SkillName },

                                            success: function (data) {
                                                $("#dialog-view").dialog("close");
                                                LoadSkillsData();
                                                toastr.success('Skill ' + SkillName + ' is Updated', 'Confirmation');
                                            },
                                            error: function (ex) {
                                                alert('in error');
                                            }
                                        })
                                    })

                                },
                                failure: function (response) {
                                    alert(response.responseText);
                                },
                                error: function (response) {
                                    alert(response.responseText);
                                }
                            });
                        }
                        else if (action == "Delete") {
                            
                            e.preventDefault();

                            $("#dialog-confirm").html("<i style='color: red;' class='bi bi-exclamation-circle-fill'></i>&nbsp;&nbsp;Are you sure to delete the selected Skill?");
                            $("#dialog-confirm").dialog({
                                title: "Delete the skill '" + skillName + "'",
                                resizable: false,
                                height: "auto",
                                width: 400,
                                modal: true,
                                buttons: {
                                    "Yes": function () {
                                        $.ajax({
                                            type: "POST",
                                            url: "/Skill/DeleteSkill?SkillId=" + skillID,
                                            success: function (response) {
                                                $("#dialog-confirm").dialog("close");
                                                LoadSkillsData();
                                                toastr.success('Skill ' + skillName + ' is Deleted', 'Confirmation');
                                            },
                                            failure: function (response) {
                                                alert(response.responseText);
                                            },
                                            error: function (response) {
                                                alert(response.responseText);
                                            }
                                        });
                                    },
                                    "No": function () {
                                        $("#dialog-confirm").dialog("close");
                                    }
                                }
                            });
                        }
                    });
                },
                error: function (ex) {
                    alert('in error');
                }
            });
        }
    </script>
}


